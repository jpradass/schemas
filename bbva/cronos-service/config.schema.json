{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "config.schema.json",
    "title": "Cronos-Service Config",
    "description": "Cronos service configuration schema",
    "type": "object",
    "properties": {
        "service": {
            "description": "Configuration related to this service",
            "type": "object",
            "properties": {
                "name": {
                    "type": "string",
                    "description": "Name of the service. This name will be registered on Cronos application"
                },
                "auth": {
                    "type": "object",
                    "description": "Configuration related to the authentication when requesting from Cronos.",
                    "properties": {
                        "user": {
                            "type": "string",
                            "description": "User that will be used to authenticate requests"
                        },
                        "password": {
                            "type": "string",
                            "description": "Password that will be used to authenticate requests"
                        },
                        "jwt_verification_key": {
                            "type": "string",
                            "description": "JWT key to validate incoming tokens on requests"
                        },
                        "jwt_signing_key": {
                            "type": "string",
                            "description": "JWT Sign in key used to validate incoming tokens on requests"
                        }
                    },
                    "required": ["user", "password", "jwt_verification_key", "jwt_signing_key"]
                },
                "namespaces": {
                    "type": "array",
                    "description": "Namespaces allowed to execute this service",
                    "items": {
                        "type": "object",
                        "properties": {
                            "id": {
                                "type": "string",
                                "description": "Id of the namespace as it is"
                            },
                            "key": {
                                "type": "string",
                                "description": "Key generated on the Cronos console once the service has been registered on the system"
                            }
                        },
                        "required": ["id", "key"]
                    },
                    "minItems": 1,
                    "uniqueItems": true
                }
            },
            "required": ["name", "auth"]
        },
        "buff_size": {
            "description": "Maximum buff (in bytes) to send to Cronos when executions generate logs",
            "type": "integer",
            "maximum": 100000
        },
        "log": {
            "type": "object",
            "description": "Service logs related configuration",
            "properties": {
                "level": {
                    "type": "string",
                    "description": "Level for the logger",
                    "enum": ["debug", "info", "warn", "error"]
                },
                "stack_size": {
                    "type": "integer",
                    "maximum": 10,
                    "description": "Number of logs stacked prior to send them to Cronos"
                },
                "send_to_back": {
                    "type": "boolean",
                    "default": false,
                    "description": "Boolean to declare if logs generated by the service will be sent to Cronos"
                }, 
                "development": {
                    "type": "boolean",
                    "default": false,
                    "description": "Boolean to declare if logs are meant to be console style or json style (to send them to a log aggregation application)"
                }
            },
            "required": ["level"]
        },
        "server": {
            "type": "object",
            "description": "Service HTTP server configuration",
            "properties": {
                "port": {
                    "type": "integer",
                    "description": "Port on which Service server will be listening non SSL requests",
                    "default": 8888
                },
                "secure": {
                    "type": "boolean",
                    "description": "Boolean to declare if Server will be setup with certificates",
                    "default": false
                },
                "ssl_port": {
                    "type": "integer",
                    "description": "Port on which Service server will be listening SSL requests",
                    "default": 8444
                },
                "crt": {
                    "type": "string",
                    "description": "Path to a valid certificate for the server",
                    "default": ""
                },
                "key": {
                    "type": "string",
                    "default": "",
                    "description": "Path to a valid key for the server. Should be unencrypted"
                },
                "root_ca": {
                    "type": "string",
                    "default": "",
                    "description": "This variable defines the path to a set of root certificate authorities that server use if required to verify a client certificate by the policy in ClientAuth."
                }
            },
            "dependencies": {
                "secure": ["ssl_port", "crt", "key", "root_ca"]
            }
        },
        "client": {
            "type": "object",
            "description": "Service HTTP client configuration",
            "properties": {
                "use_proxy": {
                    "type": "boolean",
                    "default": false,
                    "description": "Boolean to declare if Cronos needs to use a proxy to reach Service when executing"
                },
                "secure": {
                    "type": "boolean",
                    "description": "Boolean to declare if Client will be setup with certificates",
                    "default": false
                },
                "crt": {
                    "type": "string",
                    "default": "",
                    "description": "Path to a valid certificate for the client"
                },
                "key": {
                    "type": "string",
                    "default": "",
                    "description": "Path to a valid key for the client. Should be unencrypted"
                }
            },
            "dependencies": {
                "secure": ["crt", "key"]
            }
        },
        "external": {
            "type": "string",
            "default": "",
            "description": "External URL in case Cronos needs to resolve it outside its own context"
        },
        "cronos_host": {
            "type": "string",
            "description": "URL to a Cronos instance where we want the service to be registered",
            "default": "http://localhost::8080"
        },
        "cronos_api_version": {
            "type": "string",
            "description": "API Cronos version",
            "default": "v0"
        },
        "scripts": {
            "type": "object",
            "description": "Defined scripts to be run on this service instance. This scripts will be registered on the selected Cronos instance and available to be selected.",
            "properties": {
                "enabled": {
                    "type": "boolean",
                    "default": true,
                    "description": "Boolean to determine if scripts are being loaded and sent to Cronos"
                },
                "public": {
                    "type": "boolean",
                    "default": false,
                    "description": "Boolean to determine if scripts are available to other namespaces to be executed"
                },
                "from_s3": {
                    "type": "boolean",
                    "default": false,
                    "description": "Boolean to determine if scripts are loaded from some S3 instance instead of locally"
                },
                "path": {
                    "type": "string",
                    "default": "",
                    "description": "Path where scripts live in if S3 hasn't been selected"
                }, 
                "exec": {
                    "type": "array",
                    "description": "Scripts that are executable by the Service and that will appear like that in Cronos",
                    "items": {
                        "type": "object",
                        "properties": {
                            "name": {
                                "type": "string",
                                "description": "Name of the script to be referenced on Cronos"
                            },
                            "params": {
                                "type": "array",
                                "description": "Params that script would need when being executed",
                                "items": {
                                    "type": "object",
                                    "properties": {
                                        "label": {
                                            "type": "string",
                                            "description": "Label for the param to be identified"
                                        },
                                        "required": {
                                            "type": "boolean",
                                            "description": "Boolean to determine if params is required or not",
                                            "default": false
                                        },
                                        "example": {
                                            "type": "string",
                                            "description": "Example to show how to use this param",
                                            "default": ""
                                        },
                                        "description": {
                                            "type": "string",
                                            "description": "Description to help people understand what this params is used for",
                                            "default": ""
                                        }
                                    }
                                }
                            }
                        },
                        "required": ["name"]
                    }
                },
                "check": {
                    "type": "array",
                    "description": "Scripts that check executions by the Service and that will appear like that in Cronos",
                    "items": {
                        "type": "object",
                        "properties": {
                            "name": {
                                "type": "string",
                                "description": "Name of the script to be referenced on Cronos"
                            },
                            "params": {
                                "type": "array",
                                "description": "Params that script would need when being executed",
                                "items": {
                                    "type": "object",
                                    "properties": {
                                        "label": {
                                            "type": "string",
                                            "description": "Label for the param to be identified"
                                        },
                                        "required": {
                                            "type": "boolean",
                                            "description": "Boolean to determine if params is required or not",
                                            "default": false
                                        },
                                        "example": {
                                            "type": "string",
                                            "description": "Example to show how to use this param",
                                            "default": ""
                                        },
                                        "description": {
                                            "type": "string",
                                            "description": "Description to help people understand what this params is used for",
                                            "default": ""
                                        }
                                    }
                                }
                            }
                        },
                        "required": ["name"]
                    }
                },
                "cancel": {
                    "type": "array",
                    "description": "Scripts that cancel executions by the Service and that will appear like that in Cronos",
                    "items": {
                        "type": "object",
                        "properties": {
                            "name": {
                                "type": "string",
                                "description": "Name of the script to be referenced on Cronos"
                            },
                            "params": {
                                "type": "array",
                                "description": "Params that script would need when being executed",
                                "items": {
                                    "type": "object",
                                    "properties": {
                                        "label": {
                                            "type": "string",
                                            "description": "Label for the param to be identified"
                                        },
                                        "required": {
                                            "type": "boolean",
                                            "description": "Boolean to determine if params is required or not",
                                            "default": false
                                        },
                                        "example": {
                                            "type": "string",
                                            "description": "Example to show how to use this param",
                                            "default": ""
                                        },
                                        "description": {
                                            "type": "string",
                                            "description": "Description to help people understand what this params is used for",
                                            "default": ""
                                        }
                                    }
                                }
                            }
                        },
                        "required": ["name"]
                    }
                }
            },
            "required": ["enabled"]
        }
    },
    "required": ["service", "log", "server", "client", "cronos_host", "cronos_api_version"]
}